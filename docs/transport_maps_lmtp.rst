Transport Maps and LMTP
=======================

Transport maps and LMTP is used to connect Postfix and Holonet together. Transport maps is a hash
generated by Holonet. This hash contains the addresses managed by Holonet end where Postfix
should deliver these messages. LMTP is a standalone SMTP server running inside Holonet this is
the gateway used to deliver messages to Holonet.

Hooking up Postfix
------------------

Messages is transfered to Holonet using LMTP. The LMTP server inside Holonet can be started using
``manage.py lmtp_transport``. LMTP has a few settings::

    LMTP_HOST = '127.0.0.1'     # LMTP bind address
    LMTP_PORT = 8024            # Port LMTP should listen on
    LMTP_HOSTNAME = '127.0.0.1' # Used by Postfix to connect to the LMTP server.

Transport maps is the glue between Postfix and Holonet. Transport maps can be generated with the
following command ``manage.py transport_maps``. Transport maps has some settings::

    POSTFIX_POSTMAP_COMMAND = 'postmap'     # The command used to compile the maps
    POSTFIX_TRANSPORT_MAPS_LOCATION = None  # Where to store the files. If this is None,
                                            # files are stores in the transport_maps inside
                                            # the project root directory.

The command ``manage.py transport_maps`` needs to be run by a cron job each 5 minutes to update
the mappings.

Finally we need to make Postfix aware of the mappings. This is done by adding some lines in the
Postfix ``master.conf`` file.::

    transport_maps =
        hash:/path-to-holonet/transport_maps/postfix_lmtp
    local_recipient_maps =
        hash:/path-to-holonet/transport_maps/postfix_lmtp
    relay_domains =
        hash:/path-to-holonet/transport_maps/postfix_domains
